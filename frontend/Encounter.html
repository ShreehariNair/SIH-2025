<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AYUSH Dual Coding - Patient Encounters</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'green-primary': '#059669',
                        'green-secondary': '#10b981',
                        'green-light': '#d1fae5',
                        'green-dark': '#047857',
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        
        .gradient-bg {
            background: linear-gradient(135deg, #059669 0%, #10b981 50%, #34d399 100%);
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .loading-spinner {
            border: 3px solid #d1fae5;
            border-top: 3px solid #10b981;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .pulse-green {
            animation: pulseGreen 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulseGreen {
            0%, 100% { opacity: 1; }
            50% { opacity: .7; }
        }
        
        .badge-namaste {
            background: linear-gradient(135deg, #059669, #10b981);
        }
        
        .badge-icd11 {
            background: linear-gradient(135deg, #047857, #059669);
        }
        
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -6px;
            top: 0;
            width: 12px;
            height: 12px;
            background: #10b981;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 0 0 3px #d1fae5;
        }
        
        .timeline-line {
            position: absolute;
            left: -1px;
            top: 12px;
            bottom: -12px;
            width: 2px;
            background: #d1fae5;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Navigation -->
    <nav class="bg-gray-100 shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between h-16">
            <div class="flex items-center space-x-2">
                <div class="text-green-500 text-2xl">üè•</div>
                <h1 class="text-xl font-semibold text-gray-800">AYUSH</h1>
            </div>
            <div class="flex space-x-6">
                <a href="index.html" class="text-gray-700 hover:text-green-600 transition-colors duration-200">Home</a>
                <a href="Search-Codes.html" class="text-gray-700 hover:text-green-600 transition-colors duration-200">Search Codes</a>
                <a href="Encounter.html" class="text-gray-700 hover:text-green-600 transition-colors duration-200">Add Encounter</a>
                <a href="about.html" class="text-gray-700 hover:text-green-600 transition-colors duration-200">About</a>
            </div>
            <div class="flex items-center">
                <button class="text-gray-500 hover:text-gray-700 focus:outline-none">
                    <span class="sr-only">User menu</span>
                    <img src="https://via.placeholder.com/30" alt="User profile" class="w-8 h-8 rounded-full">
                </button>
            </div>
        </div>
    </nav>

    <!-- Header Section -->
    <div class="gradient-bg py-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <div class="text-6xl mb-4">üìã</div>
            <h1 class="text-4xl md:text-5xl font-bold text-white mb-4">Patient Encounters</h1>
            <p class="text-xl text-green-100 max-w-2xl mx-auto">
                Manage patient diagnoses, medical records, and healthcare encounters with dual coding system
            </p>
        </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <!-- Patient Search Section -->
        <div class="bg-white rounded-2xl shadow-xl p-8 mb-8 card-hover">
            <div class="text-center mb-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-2">Patient Information</h2>
                <p class="text-gray-600">Search for existing patients or create new encounters</p>
            </div>
            
            <div class="flex flex-col md:flex-row gap-4 max-w-4xl mx-auto">
                <div class="flex-1 relative">
                    <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                        <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                    </div>
                    <input 
                        type="text" 
                        id="patientIdInput"
                        placeholder="Enter Patient ID (e.g., P001, P002, P003)..."
                        class="w-full pl-12 pr-4 py-4 border-2 border-gray-200 rounded-xl focus:border-green-500 focus:ring-0 text-lg transition-all duration-200"
                    >
                    <div id="patientSuggestions" class="absolute top-full left-0 right-0 bg-white border border-gray-200 rounded-lg mt-1 shadow-lg hidden z-10"></div>
                </div>
                <button 
                    onclick="fetchPatientData()" 
                    class="bg-green-600 hover:bg-green-700 text-white px-8 py-4 rounded-xl font-semibold transition-all duration-200 transform hover:scale-105 shadow-lg hover:shadow-xl"
                >
                    <span class="flex items-center justify-center space-x-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                        <span>Fetch Patient</span>
                    </span>
                </button>
            </div>

            <!-- Quick Patient Access -->
            <div class="mt-6 text-center">
                <p class="text-sm text-gray-500 mb-3">Quick access to recent patients:</p>
                <div class="flex flex-wrap justify-center gap-2">
                    <button onclick="quickPatientSearch('P001')" class="px-4 py-2 bg-green-100 text-green-700 rounded-full text-sm hover:bg-green-200 transition-colors duration-200">Patient P001</button>
                    <button onclick="quickPatientSearch('P002')" class="px-4 py-2 bg-green-100 text-green-700 rounded-full text-sm hover:bg-green-200 transition-colors duration-200">Patient P002</button>
                    <button onclick="quickPatientSearch('P003')" class="px-4 py-2 bg-green-100 text-green-700 rounded-full text-sm hover:bg-green-200 transition-colors duration-200">Patient P003</button>
                    <button onclick="createNewPatient()" class="px-4 py-2 bg-blue-100 text-blue-700 rounded-full text-sm hover:bg-blue-200 transition-colors duration-200">+ New Patient</button>
                </div>
            </div>
        </div>

        <!-- Patient Information Display -->
        <div id="patientInfoSection" class="hidden mb-8">
            <div class="bg-white rounded-2xl shadow-xl overflow-hidden card-hover">
                <div class="bg-gradient-to-r from-green-600 to-green-500 p-6">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-4">
                            <div class="w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center text-2xl">üë§</div>
                            <div>
                                <h3 class="text-2xl font-bold text-white" id="patientName">Patient Name</h3>
                                <p class="text-green-100" id="patientDetails">Patient Details</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-white text-sm opacity-75">Patient ID</div>
                            <div class="text-white text-xl font-bold" id="displayPatientId">-</div>
                        </div>
                    </div>
                </div>
                <div class="p-6">
                    <div class="grid md:grid-cols-3 gap-6">
                        <div class="text-center">
                            <div class="text-2xl font-bold text-green-600" id="totalEncounters">0</div>
                            <div class="text-gray-600 text-sm">Total Encounters</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-green-600" id="activeDiagnoses">0</div>
                            <div class="text-gray-600 text-sm">Active Diagnoses</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-green-600" id="lastVisit">-</div>
                            <div class="text-gray-600 text-sm">Last Visit</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Current Encounter Section -->
        <div class="grid lg:grid-cols-2 gap-8 mb-8">
            <!-- Add New Diagnosis -->
            <div class="bg-white rounded-2xl shadow-xl p-6 card-hover">
                <div class="flex items-center space-x-3 mb-6">
                    <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center">
                        <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                        </svg>
                    </div>
                    <h3 class="text-xl font-bold text-gray-800">Add New Diagnosis</h3>
                </div>

                <form id="diagnosisForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">NAMASTE Code</label>
                        <select id="namasteCodeSelect" class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-green-500 focus:ring-0 transition-all duration-200">
                            <option value="">Select NAMASTE Code</option>
                            <option value="AYU001|Fever (Jwara)">AYU001 - Fever (Jwara)</option>
                            <option value="AYU002|Headache (Shiroroga)">AYU002 - Headache (Shiroroga)</option>
                            <option value="YOG001|Stress Management">YOG001 - Stress Management</option>
                            <option value="UNA001|Cold (Nazla)">UNA001 - Cold (Nazla)</option>
                            <option value="HOM001|Anxiety (Chinta)">HOM001 - Anxiety (Chinta)</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ICD-11 Code</label>
                        <select id="icd11CodeSelect" class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-green-500 focus:ring-0 transition-all duration-200">
                            <option value="">Select ICD-11 Code</option>
                            <option value="MG50|Fever, unspecified">MG50 - Fever, unspecified</option>
                            <option value="MB40.0|Tension-type headache">MB40.0 - Tension-type headache</option>
                            <option value="QE10|Stress-related disorders">QE10 - Stress-related disorders</option>
                            <option value="CA40|Acute upper respiratory infections">CA40 - Acute upper respiratory infections</option>
                            <option value="QA40|Anxiety disorders">QA40 - Anxiety disorders</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Clinical Notes</label>
                        <textarea 
                            id="clinicalNotes" 
                            rows="3" 
                            placeholder="Enter clinical observations and notes..."
                            class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-green-500 focus:ring-0 transition-all duration-200"
                        ></textarea>
                    </div>

                    <button 
                        type="button" 
                        onclick="addDiagnosis()"
                        class="w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-semibold transition-all duration-200 transform hover:scale-105"
                    >
                        Add Diagnosis
                    </button>
                </form>
            </div>

            <!-- Current Session Summary -->
            <div class="bg-white rounded-2xl shadow-xl p-6 card-hover">
                <div class="flex items-center space-x-3 mb-6">
                    <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center">
                        <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                    </div>
                    <h3 class="text-xl font-bold text-gray-800">Current Session</h3>
                </div>

                <div id="currentSessionContent" class="space-y-4">
                    <div class="text-center py-8 text-gray-500">
                        <div class="text-4xl mb-4">üìã</div>
                        <p>No diagnoses added yet</p>
                        <p class="text-sm mt-2">Add diagnoses to start building the encounter</p>
                    </div>
                </div>

                <div id="sessionActions" class="hidden mt-6 space-y-3">
                    <button 
                        onclick="saveEncounter()"
                        class="w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-semibold transition-all duration-200"
                    >
                        üíæ Save Encounter
                    </button>
                    <button 
                        onclick="clearSession()"
                        class="w-full bg-gray-200 hover:bg-gray-300 text-gray-700 py-3 rounded-lg font-semibold transition-all duration-200"
                    >
                        üóëÔ∏è Clear Session
                    </button>
                </div>
            </div>
        </div>

        <!-- Patient History Section -->
        <div id="patientHistorySection" class="hidden">
            <div class="bg-white rounded-2xl shadow-xl overflow-hidden card-hover">
                <div class="bg-gradient-to-r from-green-700 to-green-600 p-6">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <div class="text-3xl">üìä</div>
                            <div>
                                <h3 class="text-2xl font-bold text-white">Medical History</h3>
                                <p class="text-green-100">Complete patient encounter timeline</p>
                            </div>
                        </div>
                        <button 
                            onclick="exportPatientData()"
                            class="bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-4 py-2 rounded-lg transition-all duration-200"
                        >
                            üìÑ Export
                        </button>
                    </div>
                </div>
                <div class="p-6">
                    <div id="patientHistoryContent">
                        <!-- History content will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-12 mt-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid md:grid-cols-3 gap-8">
                <div>
                    <div class="flex items-center space-x-2 mb-4">
                        <div class="text-2xl">üè•</div>
                        <h3 class="text-xl font-bold">AYUSH Dual Coding</h3>
                    </div>
                    <p class="text-gray-300">Advanced patient encounter management with dual coding system integration.</p>
                </div>
                <div>
                    <h4 class="text-lg font-semibold mb-4">Features</h4>
                    <ul class="space-y-2 text-gray-300">
                        <li>‚Ä¢ Dual coding system (NAMASTE + ICD-11)</li>
                        <li>‚Ä¢ Patient history tracking</li>
                        <li>‚Ä¢ Clinical notes management</li>
                        <li>‚Ä¢ Export functionality</li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-lg font-semibold mb-4">SIH 2024</h4>
                    <p class="text-gray-300 mb-2">Smart India Hackathon 2024</p>
                    <p class="text-gray-300 mb-2">Healthcare Innovation</p>
                    <p class="text-gray-300">AYUSH Ministry Challenge</p>
                </div>
            </div>
            <div class="border-t border-gray-700 mt-8 pt-8 text-center text-gray-400">
                <p>&copy; 2024 AYUSH Dual Coding System. Built for Smart India Hackathon 2024.</p>
            </div>
        </div>
    </footer>

    <script>
        // Global variables
        let currentPatient = null;
        let currentSession = [];
        let patientDatabase = {
            'P001': {
                id: 'P001',
                name: 'Rajesh Kumar',
                age: 45,
                gender: 'Male',
                phone: '+91 98765 43210',
                address: 'Mumbai, Maharashtra',
                encounters: [
                    {
                        date: '2024-01-15',
                        diagnoses: [
                            { namasteCode: 'AYU001', namasteDisplay: 'Fever (Jwara)', icd11Code: 'MG50', icd11Display: 'Fever, unspecified', notes: 'High fever with body aches' }
                        ]
                    },
                    {
                        date: '2024-01-10',
                        diagnoses: [
                            { namasteCode: 'YOG001', namasteDisplay: 'Stress Management', icd11Code: 'QE10', icd11Display: 'Stress-related disorders', notes: 'Work-related stress management' }
                        ]
                    }
                ]
            },
            'P002': {
                id: 'P002',
                name: 'Priya Sharma',
                age: 32,
                gender: 'Female',
                phone: '+91 87654 32109',
                address: 'Delhi, India',
                encounters: [
                    {
                        date: '2024-01-12',
                        diagnoses: [
                            { namasteCode: 'AYU002', namasteDisplay: 'Headache (Shiroroga)', icd11Code: 'MB40.0', icd11Display: 'Tension-type headache', notes: 'Chronic headaches, stress-related' }
                        ]
                    }
                ]
            },
            'P003': {
                id: 'P003',
                name: 'Mohammed Ali',
                age: 28,
                gender: 'Male',
                phone: '+91 76543 21098',
                address: 'Bangalore, Karnataka',
                encounters: [
                    {
                        date: '2024-01-08',
                        diagnoses: [
                            { namasteCode: 'UNA001', namasteDisplay: 'Cold (Nazla)', icd11Code: 'CA40', icd11Display: 'Acute upper respiratory infections', notes: 'Common cold with congestion' }
                        ]
                    }
                ]
            }
        };

        // Patient search functionality
        function fetchPatientData() {
            const patientId = document.getElementById('patientIdInput').value.trim().toUpperCase();
            
            if (!patientId) {
                showAlert('Please enter a Patient ID', 'warning');
                return;
            }

            showLoadingState();
            
            // Simulate API call
            setTimeout(() => {
                if (patientDatabase[patientId]) {
                    currentPatient = patientDatabase[patientId];
                    displayPatientInfo(currentPatient);
                    displayPatientHistory(currentPatient);
                    showAlert(`Patient ${patientId} loaded successfully!`, 'success');
                } else {
                    showAlert(`Patient ${patientId} not found. Creating new patient record.`, 'info');
                    createNewPatientRecord(patientId);
                }
            }, 1000);
        }

        function quickPatientSearch(patientId) {
            document.getElementById('patientIdInput').value = patientId;
            fetchPatientData();
        }

        function showLoadingState() {
            const patientInfoSection = document.getElementById('patientInfoSection');
            patientInfoSection.classList.remove('hidden');
            patientInfoSection.innerHTML = `
                <div class="bg-white rounded-2xl shadow-xl p-8 text-center">
                    <div class="loading-spinner mx-auto mb-4"></div>
                    <p class="text-gray-500">Loading patient data...</p>
                </div>
            `;
        }

        function displayPatientInfo(patient) {
            document.getElementById('patientName').textContent = patient.name;
            document.getElementById('patientDetails').textContent = `${patient.age} years, ${patient.gender} ‚Ä¢ ${patient.phone}`;
            document.getElementById('displayPatientId').textContent = patient.id;
            document.getElementById('totalEncounters').textContent = patient.encounters.length;
            document.getElementById('activeDiagnoses').textContent = patient.encounters.reduce((total, enc) => total + enc.diagnoses.length, 0);
            document.getElementById('lastVisit').textContent = patient.encounters.length > 0 ? new Date(patient.encounters[0].date).toLocaleDateString() : 'No visits';

            // Show patient info section with proper content
            const patientInfoSection = document.getElementById('patientInfoSection');
            patientInfoSection.classList.remove('hidden');
            patientInfoSection.innerHTML = `
                <div class="bg-white rounded-2xl shadow-xl overflow-hidden card-hover fade-in">
                    <div class="bg-gradient-to-r from-green-600 to-green-500 p-6">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-4">
                                <div class="w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center text-2xl">üë§</div>
                                <div>
                                    <h3 class="text-2xl font-bold text-white">${patient.name}</h3>
                                    <p class="text-green-100">${patient.age} years, ${patient.gender} ‚Ä¢ ${patient.phone}</p>
                                    <p class="text-green-100 text-sm">${patient.address}</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-white text-sm opacity-75">Patient ID</div>
                                <div class="text-white text-xl font-bold">${patient.id}</div>
                            </div>
                        </div>
                    </div>
                    <div class="p-6">
                        <div class="grid md:grid-cols-3 gap-6">
                            <div class="text-center">
                                <div class="text-2xl font-bold text-green-600">${patient.encounters.length}</div>
                                <div class="text-gray-600 text-sm">Total Encounters</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-green-600">${patient.encounters.reduce((total, enc) => total + enc.diagnoses.length, 0)}</div>
                                <div class="text-gray-600 text-sm">Total Diagnoses</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-green-600">${patient.encounters.length > 0 ? new Date(patient.encounters[0].date).toLocaleDateString() : 'No visits'}</div>
                                <div class="text-gray-600 text-sm">Last Visit</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function displayPatientHistory(patient) {
            const historySection = document.getElementById('patientHistorySection');
            const historyContent = document.getElementById('patientHistoryContent');
            
            if (patient.encounters.length > 0) {
                historyContent.innerHTML = `
                    <div class="space-y-6">
                        ${patient.encounters.map((encounter, index) => `
                            <div class="relative pl-8 timeline-item slide-in" style="animation-delay: ${index * 0.1}s">
                                ${index < patient.encounters.length - 1 ? '<div class="timeline-line"></div>' : ''}
                                <div class="bg-gray-50 rounded-lg p-4">
                                    <div class="flex justify-between items-start mb-3">
                                        <h4 class="font-semibold text-gray-800">Encounter ${patient.encounters.length - index}</h4>
                                        <span class="text-sm text-gray-500">${new Date(encounter.date).toLocaleDateString()}</span>
                                    </div>
                                    <div class="space-y-3">
                                        ${encounter.diagnoses.map(diagnosis => `
                                            <div class="bg-white rounded-lg p-3 border border-gray-200">
                                                <div class="flex flex-wrap gap-2 mb-2">
                                                    <span class="badge-namaste text-white px-2 py-1 rounded text-xs font-semibold">${diagnosis.namasteCode}</span>
                                                    <span class="badge-icd11 text-white px-2 py-1 rounded text-xs font-semibold">${diagnosis.icd11Code}</span>
                                                </div>
                                                <div class="text-sm">
                                                    <div class="font-medium text-gray-800">${diagnosis.namasteDisplay}</div>
                                                    <div class="text-gray-600">${diagnosis.icd11Display}</div>
                                                    ${diagnosis.notes ? `<div class="text-gray-500 mt-1 italic">"${diagnosis.notes}"</div>` : ''}
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            } else {
                historyContent.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <div class="text-4xl mb-4">üìã</div>
                        <p class="text-lg">No medical history available</p>
                        <p class="text-sm mt-2">This patient has no previous encounters</p>
                    </div>
                `;
            }
            
            historySection.classList.remove('hidden');
        }

        function createNewPatientRecord(patientId) {
            currentPatient = {
                id: patientId,
                name: 'New Patient',
                age: 0,
                gender: 'Unknown',
                phone: 'Not provided',
                address: 'Not provided',
                encounters: []
            };
            
            displayPatientInfo(currentPatient);
            document.getElementById('patientHistorySection').classList.add('hidden');
        }

        function createNewPatient() {
            const newId = 'P' + String(Date.now()).slice(-3);
            document.getElementById('patientIdInput').value = newId;
            createNewPatientRecord(newId);
            showAlert(`New patient record created with ID: ${newId}`, 'success');
        }

        // Diagnosis management
        function addDiagnosis() {
            const namasteSelect = document.getElementById('namasteCodeSelect');
            const icd11Select = document.getElementById('icd11CodeSelect');
            const clinicalNotes = document.getElementById('clinicalNotes').value.trim();

            if (!currentPatient) {
                showAlert('Please select a patient first', 'warning');
                return;
            }

            if (!namasteSelect.value || !icd11Select.value) {
                showAlert('Please select both NAMASTE and ICD-11 codes', 'warning');
                return;
            }

            const [namasteCode, namasteDisplay] = namasteSelect.value.split('|');
            const [icd11Code, icd11Display] = icd11Select.value.split('|');

            const diagnosis = {
                namasteCode,
                namasteDisplay,
                icd11Code,
                icd11Display,
                notes: clinicalNotes,
                timestamp: new Date().toISOString()
            };

            currentSession.push(diagnosis);
            updateCurrentSession();
            clearDiagnosisForm();
            showAlert('Diagnosis added to current session', 'success');
        }

        function updateCurrentSession() {
            const sessionContent = document.getElementById('currentSessionContent');
            const sessionActions = document.getElementById('sessionActions');

            if (currentSession.length > 0) {
                sessionContent.innerHTML = `
                    <div class="space-y-3">
                        ${currentSession.map((diagnosis, index) => `
                            <div class="bg-gray-50 rounded-lg p-3 border border-gray-200">
                                <div class="flex justify-between items-start">
                                    <div class="flex-1">
                                        <div class="flex flex-wrap gap-2 mb-2">
                                            <span class="badge-namaste text-white px-2 py-1 rounded text-xs font-semibold">${diagnosis.namasteCode}</span>
                                            <span class="badge-icd11 text-white px-2 py-1 rounded text-xs font-semibold">${diagnosis.icd11Code}</span>
                                        </div>
                                        <div class="text-sm">
                                            <div class="font-medium text-gray-800">${diagnosis.namasteDisplay}</div>
                                            <div class="text-gray-600">${diagnosis.icd11Display}</div>
                                            ${diagnosis.notes ? `<div class="text-gray-500 mt-1 italic">"${diagnosis.notes}"</div>` : ''}
                                        </div>
                                    </div>
                                    <button 
                                        onclick="removeDiagnosis(${index})"
                                        class="ml-2 text-red-500 hover:text-red-700 p-1"
                                    >
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
                sessionActions.classList.remove('hidden');
            } else {
                sessionContent.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <div class="text-4xl mb-4">üìã</div>
                        <p>No diagnoses added yet</p>
                        <p class="text-sm mt-2">Add diagnoses to start building the encounter</p>
                    </div>
                `;
                sessionActions.classList.add('hidden');
            }
        }

        function removeDiagnosis(index) {
            currentSession.splice(index, 1);
            updateCurrentSession();
            showAlert('Diagnosis removed from session', 'info');
        }

        function clearDiagnosisForm() {
            document.getElementById('namasteCodeSelect').value = '';
            document.getElementById('icd11CodeSelect').value = '';
            document.getElementById('clinicalNotes').value = '';
        }

        function clearSession() {
            currentSession = [];
            updateCurrentSession();
            showAlert('Session cleared', 'info');
        }

        function saveEncounter() {
            if (!currentPatient) {
                showAlert('Please select a patient first', 'warning');
                return;
            }

            if (currentSession.length === 0) {
                showAlert('Please add at least one diagnosis', 'warning');
                return;
            }

            // Add encounter to patient record
            const newEncounter = {
                date: new Date().toISOString().split('T')[0],
                diagnoses: [...currentSession]
            };

            currentPatient.encounters.unshift(newEncounter);
            patientDatabase[currentPatient.id] = currentPatient;

            // Clear current session
            currentSession = [];
            updateCurrentSession();

            // Refresh patient display
            displayPatientInfo(currentPatient);
            displayPatientHistory(currentPatient);

            showAlert(`Encounter saved successfully! ${newEncounter.diagnoses.length} diagnoses recorded.`, 'success');
        }

        function exportPatientData() {
            if (!currentPatient) {
                showAlert('No patient data to export', 'warning');
                return;
            }

            const exportData = {
                patient: currentPatient,
                exportDate: new Date().toISOString(),
                totalEncounters: currentPatient.encounters.length,
                totalDiagnoses: currentPatient.encounters.reduce((total, enc) => total + enc.diagnoses.length, 0)
            };

            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `patient_${currentPatient.id}_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            URL.revokeObjectURL(url);
            showAlert('Patient data exported successfully', 'success');
        }

        // Utility functions
        function showAlert(message, type) {
            const alertColors = {
                success: 'bg-green-100 border-green-400 text-green-700',
                warning: 'bg-yellow-100 border-yellow-400 text-yellow-700',
                error: 'bg-red-100 border-red-400 text-red-700',
                info: 'bg-blue-100 border-blue-400 text-blue-700'
            };

            const alert = document.createElement('div');
            alert.className = `fixed top-4 right-4 z-50 ${alertColors[type]} border px-4 py-3 rounded-lg shadow-lg transition-all duration-300 transform translate-x-full max-w-sm`;
            alert.innerHTML = `
                <div class="flex items-center space-x-2">
                    <span class="flex-1">${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-2 font-bold text-lg leading-none">&times;</button>
                </div>
            `;

            document.body.appendChild(alert);
            
            setTimeout(() => {
                alert.classList.remove('translate-x-full');
            }, 100);

            setTimeout(() => {
                alert.classList.add('translate-x-full');
                setTimeout(() => alert.remove(), 300);
            }, 4000);
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Add Enter key support for patient search
            document.getElementById('patientIdInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    fetchPatientData();
                }
            });

            // Add patient ID suggestions
            const patientInput = document.getElementById('patientIdInput');
            const suggestions = document.getElementById('patientSuggestions');
            
            patientInput.addEventListener('input', function() {
                const value = this.value.toUpperCase();
                if (value.length > 0) {
                    const matches = Object.keys(patientDatabase).filter(id => id.includes(value));
                    if (matches.length > 0) {
                        suggestions.innerHTML = matches.map(id => `
                            <div class="p-2 hover:bg-gray-100 cursor-pointer" onclick="quickPatientSearch('${id}')">
                                <div class="font-medium">${id}</div>
                                <div class="text-sm text-gray-600">${patientDatabase[id].name}</div>
                            </div>
                        `).join('');
                        suggestions.classList.remove('hidden');
                    } else {
                        suggestions.classList.add('hidden');
                    }
                } else {
                    suggestions.classList.add('hidden');
                }
            });

            // Hide suggestions when clicking outside
            document.addEventListener('click', function(e) {
                if (!patientInput.contains(e.target) && !suggestions.contains(e.target)) {
                    suggestions.classList.add('hidden');
                }
            });

            // Initialize current session display
            updateCurrentSession();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9821e992a39c8ee8',t:'MTc1ODM3NzQ5MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>